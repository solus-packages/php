name       : php
version    : 7.2.9
release    : 64
source     :
    - http://php.net/distributions/php-7.2.9.tar.xz : 3585c1222e00494efee4f5a65a8e03a1e6eca3dfb834814236ee7f02c5248ae0
license    : PHP-3.01
component  : programming
summary    : PHP is a popular general-purpose scripting language that is especially suited to web development
description: |
    PHP is a popular general-purpose scripting language that is especially suited to web development.
builddeps  :
    - pkgconfig(enchant)
    - pkgconfig(freetype2)
    - pkgconfig(gdlib)
    - pkgconfig(icu-i18n)
    - pkgconfig(libcurl)
    - pkgconfig(libexif)
    - pkgconfig(libpng)
    - pkgconfig(libpq)
    - pkgconfig(libsasl2)
    - pkgconfig(libturbojpeg)
    - pkgconfig(libxml-2.0)
    - pkgconfig(libxslt)
    - pkgconfig(libzip)
    - pkgconfig(openssl)
    - pkgconfig(sqlite3)
    - pkgconfig(zlib)
    - bzip2-devel
    - gettext-devel
    - imap-devel
    - libmhash-devel
    - libtool
    - net-snmp-devel
    - openldap-devel
    - tidy-html5-devel
setup      : |
    unset LD_AS_NEEDED
    export EXTENSION_DIR=%libdir%/php/modules/
    cp $pkgfiles/php.ini-production ./

    # Swap out /var/run for /run

    sed -i 's:/var/run:/run:' ext/fileinfo/tests/magic
    sed -i 's:/var/run:/run:' sapi/phpdbg/phpdbg.init.d
    libtoolize --force
    aclocal
    autoconf
    %configure --prefix=/usr --disable-static --with-config-file-path=/etc/php/ --bindir=/usr/bin/ --mandir=/usr/share/man \
         --enable-bcmath \
         --enable-calendar=shared \
         --enable-exif=shared \
         --enable-fpm \
         --enable-ftp=shared \
         --enable-gd-native-ttf \
         --enable-intl=shared \
         --enable-libxml=shared \
         --enable-mbstring \
         --enable-opcache \
         --enable-pcntl \
         --enable-phar \
         --enable-posix=shared \
         --enable-shmop=shared \
         --enable-soap=shared \
         --enable-sockets=shared \
         --enable-zend-signals \
         --enable-zip=shared \
         --mandir=/usr/share/man \
         --sysconfdir=/etc/php \
         --with-bz2=shared \
         --with-config-file-path=/etc/php \
         --with-config-file-scan-dir=/etc/php/conf.d \
         --with-curl=shared \
         --with-enchant=shared \
         --with-fpm-user=phpfpm \
         --with-fpm-group=phpfpm \
         --with-fpm-systemd \
         --with-freetype-dir=/usr \
         --with-gd=shared \
         --with-gettext=shared \
         --with-gmp=shared \
         --with-iconv=shared \
         --with-icu-dir=/usr \
         --with-imap=shared \
         --with-imap-ssl \
         --with-jpeg-dir=/usr \
         --with-ldap=shared \
         --with-ldap-sasl \
         --with-libdir=lib64 \
         --with-libzip \
         --with-mhash \
         --with-mysqli=shared,mysqlnd \
         --with-openssl \
         --with-openssl-dir=/usr/bin \
         --with-pcre-regex=/usr \
         --with-pdo-mysql=shared,mysqlnd \
         --with-pdo-pgsql=shared \
         --with-pdo-sqlite=shared,/usr \
         --with-pgsql=shared \
         --with-png-dir=/usr \
         --with-readline \
         --with-snmp=shared \
         --with-sqlite3=shared,/usr \
         --with-tidy=shared \
         --with-xsl=/usr \
         --with-zlib
build      : |
    unset LD_AS_NEEDED
    export EXTENSION_DIR=%libdir%/php/modules/
    %make
profile    : |
    export NO_INTERACTION=1 REPORT_EXIT_STATUS=1 SKIP_ONLINE_TESTS=1 SKIP_IO_CAPTURE_TESTS SKIP_IO_CAPTURE_TESTS=1
    unset TZ LANG LC_ALL
    %make test || :
install    : |
    unset LD_AS_NEEDED
    export EXTENSION_DIR=%libdir%/php/modules/
    make INSTALL_ROOT=%installroot% install
    # Cleanup
    rm -rf $installdir/etc/php/php-fpm.d/www.conf.default
    rm -rf $installdir/usr/lib64/php/modules/*.a
    rm -rf $installdir/usr/include/php/include
    rm -rf %installroot%/var
    rm -rf $installdir/.{channels,depdb,depdblock,filemap,lock,registry}
    # Install configs
    install $pkgfiles/php.ini-production $installdir/etc/php/php.ini
    install $pkgfiles/www.conf $installdir/etc/php/php-fpm.d/www.conf
    mv $installdir/etc/php/php-fpm.conf.default $installdir/etc/php/php-fpm.conf
    # Setup service and tmpfiles
    sed 's:${exec_prefix}:/usr:g' -i sapi/fpm/php-fpm.service
    install -Dm00644 sapi/fpm/php-fpm.service $installdir/%libdir%/systemd/system/php-fpm.service
    install -Dm00644 $pkgfiles/phpfpm.sysusers $installdir%libdir%/sysusers.d/phpfpm.conf
    install -Dm00644 $pkgfiles/phpfpm.tmpfiles $installdir/%libdir%/tmpfiles.d/php-fpm.conf
